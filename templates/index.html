{% extends "base.html" %}
{% block content %}

<!-- Header -->
<div class="d-flex justify-content-between align-items-center mb-4">
  <h2 class="fw-bold"><i class="bi bi-speedometer2"></i> Dashboard</h2>
  <a href="/add" class="btn btn-success shadow-sm">
    <i class="bi bi-plus-lg"></i> เพิ่มงาน
  </a>
</div>

<!-- หมายเหตุข้อมูล -->
<div class="alert alert-warning py-2" role="alert">
  <small class="mb-0">ตั้งแต่วันที่ 4/10/2568 - 29/10/2568 ข้อมูลอาจไม่ตรงตามวันจริงเนื่องจากฐานข้อมูลเดิมหาย</small>
</div>

<!-- Filter / Search -->
<form method="GET" class="row g-3 mb-4 bg-white p-3 rounded shadow-sm align-items-end">
  <div class="col-md-2">
    <label class="form-label">วันที่</label>
    <input type="date" name="date" class="form-control" value="{{ request.args.get('date','') }}">
  </div>
  <div class="col-md-2">
    <label class="form-label">สถานะ</label>
    <select name="status" class="form-select">
      <option value="">ทุกสถานะ</option>
      <option value="done" {% if request.args.get('status')=='done' %}selected{% endif %}>เสร็จแล้ว</option>
      <option value="in progress" {% if request.args.get('status')=='in progress' %}selected{% endif %}>กำลังทำ</option>
      <option value="pending" {% if request.args.get('status')=='pending' %}selected{% endif %}>รอดำเนินการ</option>
    </select>
  </div>
  <div class="col-md-2">
    <label class="form-label">หมวดหมู่</label>
    <select name="category_filter" class="form-select" onchange="this.form.submit()">
      <option value="">ทั้งหมด</option>
      <option value="Hardware" {% if request.args.get('category_filter')=='Hardware' %}selected{% endif %}>Hardware</option>
      <option value="General" {% if request.args.get('category_filter')=='General' %}selected{% endif %}>General</option>
      <option value="Software" {% if request.args.get('category_filter')=='Software' %}selected{% endif %}>Software</option>
      <option value="Configuration,System" {% if request.args.get('category_filter')=='Configuration,System' %}selected{% endif %}>Configuration,System</option>
      <option value="Troubleshoot" {% if request.args.get('category_filter')=='Troubleshoot' %}selected{% endif %}>Troubleshoot</option>
    </select>
  </div>
  <div class="col-md-3">
    <label class="form-label">ค้นหา</label>
    <input type="text" name="keyword" class="form-control" placeholder="ค้นหา..." value="{{ request.args.get('keyword','') }}">
  </div>
  <div class="col-md-3">
    <button type="submit" class="btn btn-primary w-100 mt-2">
      <i class="bi bi-funnel"></i> Filter
    </button>
  </div>
</form>

<!-- Summary Cards -->
<div class="row g-3 mb-4">
  <div class="col-md-4">
    <div class="card shadow-sm text-center border-0" style="background-color: #4caf50; color: white;">
      <div class="card-body">
        <h5>เสร็จแล้ว</h5>
        <p class="fs-3 fw-bold">{{ done }}</p>
      </div>
    </div>
  </div>
  <div class="col-md-4">
    <div class="card shadow-sm text-center border-0" style="background-color: #ffca28; color: #212529;">
      <div class="card-body">
        <h5>กำลังทำ</h5>
        <p class="fs-3 fw-bold">{{ in_progress }}</p>
      </div>
    </div>
  </div>
  <div class="col-md-4">
    <div class="card shadow-sm text-center border-0" style="background-color: #f44336; color: white;">
      <div class="card-body">
        <h5>รอดำเนินการ</h5>
        <p class="fs-3 fw-bold">{{ pending }}</p>
      </div>
    </div>
  </div>
</div>

<!-- Charts -->
<div class="row g-3 mb-4">
  <div class="col-md-6">
    <div class="card shadow-sm">
      <div class="card-body">
        <h6 class="fw-bold text-center mb-3">สัดส่วนงานทั้งหมด</h6>
        <div class="chart-container" style="height:250px;">
          <canvas id="statusChart"></canvas>
        </div>
      </div>
    </div>
  </div>
  <div class="col-md-6">
    <div class="card shadow-sm">
      <div class="card-body">
        <h6 class="fw-bold text-center mb-3">สถิติย้อนหลัง 7 วัน</h6>
        <div class="chart-container" style="height:250px;">
          <canvas id="trendChart"></canvas>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Table -->
<div class="card shadow-sm">
  <div class="card-header bg-primary text-white fw-bold">
    รายการงานทั้งหมด
  </div>
  <div class="card-body table-responsive">
    <table class="table table-striped align-middle table-hover">
      <thead class="table-dark text-center">
        <tr>
          <th><i class="bi bi-calendar-date"></i> วันที่</th>
          <th><i class="bi bi-tag"></i> ประเภท</th>
          <th><i class="bi bi-journal-text"></i> รายละเอียด</th>
          <th><i class="bi bi-hourglass-split"></i> สถานะ</th>
          <th><i class="bi bi-gear"></i> จัดการ</th>
        </tr>
      </thead>
      <tbody>
        {% for log in logs %}
        <tr>
          <td class="text-nowrap text-center">{{ log.work_date }}</td>
          <td>{{ log.category }}</td>
          <td>{{ log.description }}</td>
          <td class="text-center">
            {% if log.status == 'done' %}
              <span class="badge bg-success">เสร็จแล้ว</span>
            {% elif log.status == 'in progress' %}
              <span class="badge bg-warning text-dark">กำลังทำ</span>
            {% else %}
              <span class="badge bg-danger">รอดำเนินการ</span>
            {% endif %}
          </td>
          <td class="text-center">
            <div class="d-flex justify-content-center gap-2 flex-nowrap">
              <a href="/edit/{{ log.id }}" class="btn btn-sm btn-outline-warning">
                <i class="bi bi-pencil"></i>
              </a>
              <a href="/delete/{{ log.id }}" class="btn btn-sm btn-outline-danger" onclick="return confirm('คุณแน่ใจหรือไม่?')">
                <i class="bi bi-trash"></i>
              </a>
            </div>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

{% endblock %}
